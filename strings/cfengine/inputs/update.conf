control:
    actionsequence  = ( links copy shellcommands )
    domain          = ( ExecResult("/bin/dnsdomainname") )
    AddInstallable  = ( failover_1  failover_2  failover_3 failover_4 bitched_up )
    cfmasterfiles   = ( /var/cfengine/masterfiles )
    cfroot          = ( /var/cfengine )
    cfscripts       = ( $(cfroot)/scripts )
    server_1        = ( ExecResult("$(cfscripts)/rrdig -1 cfengine.$(domain)") )
    server_2        = ( ExecResult("$(cfscripts)/rrdig -2 cfengine.$(domain)") )
    server_3        = ( ExecResult("$(cfscripts)/rrdig -3 cfengine.$(domain)") )
    server_4        = ( ExecResult("$(cfscripts)/rrdig -4 cfengine.$(domain)") )
    server_5        = ( ExecResult("$(cfscripts)/rrdig -5 cfengine.$(domain)") )
    server_self     = ( ExecResult("/bin/hostname -f") )

copy:
    any::
        $(cfmasterfiles)/inputs dest=$(cfroot)/inputs
        r=inf mode=700 type=binary exclude=*.lst exclude=*~ exclude=#* 
        server=$(server_1) trustkey=true failover=failover_1
        $(cfmasterfiles)/config dest=$(cfroot)/config
        r=inf mode=700 type=binary exclude=*.lst exclude=*~ exclude=#* 
        server=$(server_1) trustkey=true failover=failover_1
        $(cfmasterfiles)/modules dest=$(cfroot)/modules
        r=inf mode=700 type=binary exclude=*.lst exclude=*~ exclude=#* 
        server=$(server_1) trustkey=true failover=failover_1
        $(cfmasterfiles)/scripts dest=$(cfroot)/scripts
        r=inf mode=700 type=binary exclude=*.lst exclude=*~ exclude=#* 
        server=$(server_1) trustkey=true failover=failover_1

    failover_1::
        $(cfmasterfiles)/inputs dest=$(cfroot)/inputs
        r=inf mode=700 type=binary exclude=*.lst exclude=*~ exclude=#* 
        server=$(server_2) trustkey=true failover=failover_2
        $(cfmasterfiles)/config dest=$(cfroot)/config
        r=inf mode=700 type=binary exclude=*.lst exclude=*~ exclude=#* 
        server=$(server_2) trustkey=true failover=failover_2
        $(cfmasterfiles)/modules dest=$(cfroot)/modules
        r=inf mode=700 type=binary exclude=*.lst exclude=*~ exclude=#* 
        server=$(server_2) trustkey=true failover=failover_2
        $(cfmasterfiles)/scripts dest=$(cfroot)/scripts
        r=inf mode=700 type=binary exclude=*.lst exclude=*~ exclude=#* 
        server=$(server_2) trustkey=true failover=failover_2

    failover_2::
        $(cfmasterfiles)/inputs dest=$(cfroot)/inputs
        r=inf mode=700 type=binary exclude=*.lst exclude=*~ exclude=#* 
        server=$(server_3) trustkey=true failover=failover_3
        $(cfmasterfiles)/config dest=$(cfroot)/config
        r=inf mode=700 type=binary exclude=*.lst exclude=*~ exclude=#* 
        server=$(server_3) trustkey=true failover=failover_3
        $(cfmasterfiles)/modules dest=$(cfroot)/modules
        r=inf mode=700 type=binary exclude=*.lst exclude=*~ exclude=#* 
        server=$(server_3) trustkey=true failover=failover_3
        $(cfmasterfiles)/scripts dest=$(cfroot)/scripts
        r=inf mode=700 type=binary exclude=*.lst exclude=*~ exclude=#* 
        server=$(server_3) trustkey=true failover=failover_3

    failover_3::
        $(cfmasterfiles)/inputs dest=$(cfroot)/inputs
        r=inf mode=700 type=binary exclude=*.lst exclude=*~ exclude=#* 
        server=$(server_4) trustkey=true failover=failover_4
        $(cfmasterfiles)/config dest=$(cfroot)/config
        r=inf mode=700 type=binary exclude=*.lst exclude=*~ exclude=#* 
        server=$(server_4) trustkey=true failover=failover_4
        $(cfmasterfiles)/modules dest=$(cfroot)/modules
        r=inf mode=700 type=binary exclude=*.lst exclude=*~ exclude=#* 
        server=$(server_4) trustkey=true failover=failover_4
        $(cfmasterfiles)/scripts dest=$(cfroot)/scripts
        r=inf mode=700 type=binary exclude=*.lst exclude=*~ exclude=#* 
        server=$(server_4) trustkey=true failover=failover_4

    failover_4::
        $(cfmasterfiles)/inputs dest=$(cfroot)/inputs
        r=inf mode=700 type=binary exclude=*.lst exclude=*~ exclude=#* 
        server=$(server_5) trustkey=true failover=failover_5
        $(cfmasterfiles)/config dest=$(cfroot)/config
        r=inf mode=700 type=binary exclude=*.lst exclude=*~ exclude=#* 
        server=$(server_5) trustkey=true failover=failover_5
        $(cfmasterfiles)/modules dest=$(cfroot)/modules
        r=inf mode=700 type=binary exclude=*.lst exclude=*~ exclude=#* 
        server=$(server_5) trustkey=true failover=failover_5
        $(cfmasterfiles)/scripts dest=$(cfroot)/scripts
        r=inf mode=700 type=binary exclude=*.lst exclude=*~ exclude=#* 
        server=$(server_5) trustkey=true failover=failover_5

    bitched_up::
        $(cfmasterfiles)/inputs dest=$(cfroot)/inputs
        r=inf mode=700 type=binary exclude=*.lst exclude=*~ exclude=#* 
        server=$(server_self) trustkey=true failover=failover_self
        $(cfmasterfiles)/config dest=$(cfroot)/config
        r=inf mode=700 type=binary exclude=*.lst exclude=*~ exclude=#* 
        server=$(server_self) trustkey=true failover=failover_self
        $(cfmasterfiles)/modules dest=$(cfroot)/modules
        r=inf mode=700 type=binary exclude=*.lst exclude=*~ exclude=#* 
        server=$(server_self) trustkey=true failover=failover_self
        $(cfmasterfiles)/scripts dest=$(cfroot)/scripts
        r=inf mode=700 type=binary exclude=*.lst exclude=*~ exclude=#* 
        server=$(server_self) trustkey=true failover=failover_self

alerts:
    bitched_up::
        "Failed to copy configurations from any source attempting from self"
