control:
    prepmodule0     = ( PrepModule(module:dynclass,"") )
    prepmodule1     = ( PrepModule(module:cfroot,"") )
    actionsequence  = ( links copy shellcommands )
    domain          = ( ExecResult("/bin/dnsdomainname") )
    AddInstallable  = ( failover_1  failover_2  failover_3 failover_4 bitched_up )
    cfmasterfiles   = ( $(cfengine_root)/masterfiles )
    cfscripts       = ( $(cfengine_root)/scripts )
    server_1        = ( ExecResult("$(cfscripts)/rrdig -1 cfengine.$(domain)") )
    server_2        = ( ExecResult("$(cfscripts)/rrdig -2 cfengine.$(domain)") )
    server_3        = ( ExecResult("$(cfscripts)/rrdig -3 cfengine.$(domain)") )
    server_4        = ( ExecResult("$(cfscripts)/rrdig -4 cfengine.$(domain)") )
    server_5        = ( ExecResult("$(cfscripts)/rrdig -5 cfengine.$(domain)") )
    server_self     = ( ExecResult("/bin/hostname -f") )

links: 
    linux::
        /usr/local/bin/perl -> /usr/bin/perl type=symbolic

copy:
    any::
        $(cfmasterfiles)/inputs dest=$(cfengine_root)/inputs
        r=inf mode=700 type=binary exclude=*.lst exclude=*~ exclude=#* 
        server=$(server_1) trustkey=true failover=failover_1
        $(cfmasterfiles)/config dest=$(cfengine_root)/config
        r=inf mode=700 type=binary exclude=*.lst exclude=*~ exclude=#* 
        server=$(server_1) trustkey=true failover=failover_1
        $(cfmasterfiles)/modules dest=$(cfengine_root)/modules
        r=inf mode=700 type=binary exclude=*.lst exclude=*~ exclude=#* 
        server=$(server_1) trustkey=true failover=failover_1
        $(cfmasterfiles)/scripts dest=$(cfengine_root)/scripts
        r=inf mode=700 type=binary exclude=*.lst exclude=*~ exclude=#* 
        server=$(server_1) trustkey=true failover=failover_1

    failover_1::
        $(cfmasterfiles)/inputs dest=$(cfengine_root)/inputs
        r=inf mode=700 type=binary exclude=*.lst exclude=*~ exclude=#* 
        server=$(server_2) trustkey=true failover=failover_2 owner=root group=root

        $(cfmasterfiles)/config dest=$(cfengine_root)/config
        r=inf mode=700 type=binary exclude=*.lst exclude=*~ exclude=#* 
        server=$(server_2) trustkey=true failover=failover_2 owner=root group=root

        $(cfmasterfiles)/modules dest=$(cfengine_root)/modules
        r=inf mode=700 type=binary exclude=*.lst exclude=*~ exclude=#* 
        server=$(server_2) trustkey=true failover=failover_2 owner=root group=root

        $(cfmasterfiles)/scripts dest=$(cfengine_root)/scripts
        r=inf mode=700 type=binary exclude=*.lst exclude=*~ exclude=#* 
        server=$(server_2) trustkey=true failover=failover_2 owner=root group=root

    failover_2::
        $(cfmasterfiles)/inputs dest=$(cfengine_root)/inputs
        r=inf mode=700 type=binary exclude=*.lst exclude=*~ exclude=#* 
        server=$(server_3) trustkey=true failover=failover_3 owner=root group=root
        $(cfmasterfiles)/config dest=$(cfengine_root)/config
        r=inf mode=700 type=binary exclude=*.lst exclude=*~ exclude=#* 
        server=$(server_3) trustkey=true failover=failover_3 owner=root group=root
        $(cfmasterfiles)/modules dest=$(cfengine_root)/modules
        r=inf mode=700 type=binary exclude=*.lst exclude=*~ exclude=#* 
        server=$(server_3) trustkey=true failover=failover_3 owner=root group=root
        $(cfmasterfiles)/scripts dest=$(cfengine_root)/scripts
        r=inf mode=700 type=binary exclude=*.lst exclude=*~ exclude=#* 
        server=$(server_3) trustkey=true failover=failover_3 owner=root group=root

    failover_3::
        $(cfmasterfiles)/inputs dest=$(cfengine_root)/inputs
        r=inf mode=700 type=binary exclude=*.lst exclude=*~ exclude=#* 
        server=$(server_4) trustkey=true failover=failover_4 owner=root group=root
        $(cfmasterfiles)/config dest=$(cfengine_root)/config
        r=inf mode=700 type=binary exclude=*.lst exclude=*~ exclude=#* 
        server=$(server_4) trustkey=true failover=failover_4 owner=root group=root
        $(cfmasterfiles)/modules dest=$(cfengine_root)/modules
        r=inf mode=700 type=binary exclude=*.lst exclude=*~ exclude=#* 
        server=$(server_4) trustkey=true failover=failover_4 owner=root group=root
        $(cfmasterfiles)/scripts dest=$(cfengine_root)/scripts
        r=inf mode=700 type=binary exclude=*.lst exclude=*~ exclude=#* 
        server=$(server_4) trustkey=true failover=failover_4 owner=root group=root

    failover_4::
        $(cfmasterfiles)/inputs dest=$(cfengine_root)/inputs
        r=inf mode=700 type=binary exclude=*.lst exclude=*~ exclude=#* 
        server=$(server_5) trustkey=true failover=failover_5 owner=root group=root
        $(cfmasterfiles)/config dest=$(cfengine_root)/config
        r=inf mode=700 type=binary exclude=*.lst exclude=*~ exclude=#* 
        server=$(server_5) trustkey=true failover=failover_5 owner=root group=root
        $(cfmasterfiles)/modules dest=$(cfengine_root)/modules
        r=inf mode=700 type=binary exclude=*.lst exclude=*~ exclude=#* 
        server=$(server_5) trustkey=true failover=failover_5 owner=root group=root
        $(cfmasterfiles)/scripts dest=$(cfengine_root)/scripts
        r=inf mode=700 type=binary exclude=*.lst exclude=*~ exclude=#* 
        server=$(server_5) trustkey=true failover=failover_5 owner=root group=root

    bitched_up::
        $(cfmasterfiles)/inputs dest=$(cfengine_root)/inputs
        r=inf mode=700 type=binary exclude=*.lst exclude=*~ exclude=#* 
        server=$(server_self) trustkey=true failover=failover_self
        $(cfmasterfiles)/config dest=$(cfengine_root)/config owner=root group=root
        r=inf mode=700 type=binary exclude=*.lst exclude=*~ exclude=#* 
        server=$(server_self) trustkey=true failover=failover_self owner=root group=root
        $(cfmasterfiles)/modules dest=$(cfengine_root)/modules 
        r=inf mode=700 type=binary exclude=*.lst exclude=*~ exclude=#* 
        server=$(server_self) trustkey=true failover=failover_self owner=root group=root
        $(cfmasterfiles)/scripts dest=$(cfengine_root)/scripts
        r=inf mode=700 type=binary exclude=*.lst exclude=*~ exclude=#* 
        server=$(server_self) trustkey=true failover=failover_self owner=root group=root

alerts:
    bitched_up::
        "Failed to copy configurations from any source attempting from self"
